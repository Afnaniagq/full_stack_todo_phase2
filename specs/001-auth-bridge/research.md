# Research: Foundation: Infrastructure & Authentication Bridge

## Overview
This document captures the research and key decisions made during the planning phase for the authentication bridge feature, including technology choices, architectural decisions, and implementation approaches.

## Decision: Auth Secret Synchronization
**Rationale**: To meet the requirement that "Next.js and FastAPI environments sharing a synchronized .env configuration," we chose to implement a shared .env file at the repository root level that both services can access.

**Alternatives considered**:
1. Separate environment files per service - rejected as it increases complexity and risk of desynchronization
2. Centralized configuration service - overkill for this use case
3. Shared .env file at root - chosen for simplicity and reliability

## Decision: User ID Format
**Rationale**: Selected UUID format for User IDs to provide non-sequential security as specified in requirements.

**Alternatives considered**:
1. Auto-incrementing integers - rejected due to security concerns (predictable IDs)
2. BigInt - rejected for same security reasons
3. UUID - chosen for security and global uniqueness properties

## Decision: JWT Verification Library
**Rationale**: Selected PyJWT for FastAPI backend to ensure stable JWT verification that can validate tokens generated by Better Auth on the frontend.

**Alternatives considered**:
1. python-jose - considered but PyJWT has better stability and maintenance
2. jwt module from standard library - lacks necessary features for verification
3. PyJWT - chosen for stability and feature completeness as specified in requirements

## Database Connection Security
**Rationale**: Implemented SSL enforcement with `sslmode=require` for Neon PostgreSQL connections to satisfy security requirements.

**Best practices confirmed**:
- Use connection pooling for production deployments
- Validate SSL certificates properly
- Handle connection failures gracefully

## Cross-Service Verification Approach
**Rationale**: Created a verification approach where tokens generated by Better Auth (TS) can be verified by PyJWT (Python) using the same shared secret and token claims ('sub', 'exp').

**Implementation pattern**:
- Shared `BETTER_AUTH_SECRET` across both services
- Consistent token claims structure
- Proper error handling for invalid tokens